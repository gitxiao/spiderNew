<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>永兴印刷订单生产管理系统-产品管理</title>
	<link rel="stylesheet" type="text/css" href="css/easyui/easyui.css" />
	<link rel="stylesheet" type="text/css" href="css/easyui/icon.css" />
	<link rel="stylesheet" type="text/css" href="css/easyui/demo.css" />
	<link rel="stylesheet" type="text/css" href="css/cf/table.css" />
	<script type="text/javascript" src="js/easyui/jquery.min.js"></script>
	<script type="text/javascript" src="js/easyui/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="js/easyui/easyui-lang-zh_CN.js"></script>
	<script type="text/javascript" src="js/myConstants.js"></script>
	
	<script>
	
		$(function(){
			//产品出库初始化
			setProductEnterFormCode();
			loadEnterPerson();
			loadOverProduceFrom();
			//产品入库初始化
			setProductOutFormCode();
			loadOverOrderFrom();
		});
		function setProductEnterFormCode(){
			$.post(opertionUrl+"productEnter/findNextPFormCode",loadProductFormCodeSuccess,"text");
		}
		function loadProductFormCodeSuccess(data){
			$("#piFormCode").html(data);
		}
		function loadEnterPerson(){
			$.post(opertionUrl+"workerinfo/findWorkerByDuty",{para:4},loadEnterPersonSuccess,"json");
		}
		function loadEnterPersonSuccess(data){
			$("#enterPerson").combobox('loadData', data);
			$("#outPerson").combobox('loadData', data);
		}
		function loadOverProduceFrom(){
			$.post(opertionUrl+"makelist/findMakeListByState",{state:2},loadOverProduceFromSuccess,"json");
		}
		function loadOverProduceFromSuccess(data){
			$("#pFormCode").combobox('loadData', data);
		}
		function loadDetailProduceForm(){
			var  pfId = $("#pFormCode").combobox('getValue');
			$.post(opertionUrl+"makelist/findDetailMakeListById",{id:pfId},loadDetailProduceFormSuccess,"json");
		}
		function loadDetailProduceFormSuccess(data){
			if(data){
				$("#productName").html(data.productName);
				$("#productCount").html(data.productCount);
				$("#cusName").html(data.cusName);
				$("#doCount").html(data.producedNum);
				$("#oneProductPage").html(data.pagination);
				$("#totalProductCount").html(data.allPageNum);
				$("#printPerson").html(data.printerName);
				$("#bindPerson").html(data.binderName);
				$("#planCount").html(data.planPage);
				$("#paperName").html(data.paperDetail+"g/张");
				$("#mid").val(data.paperId);
				$("#ofId").val(data.id);
			}
		}
		function submitProductEnterForm(){
			
			var para = '{"mid":'+$("#mid").val()+',"ofId":'+$("#ofId").val()+',"enterCode":"'+$("#piFormCode").text()+'","mCount":'+$("#remainPaperCount").textbox("getValue")+
				',"doCount":'+$("#doCount").text()+',"enterCount":'+$("#enterCount").textbox("getValue")+',"enterPersonId":'+$("#enterPerson").combobox("getValue")+'}';
			$.post(opertionUrl+"productEnter/saveProdunctEnterForm",{para:para},saveProductEnterFormSuccess,"text");
		}
		function saveProductEnterFormSuccess(data){
			if(data=='-2'){
				$.messager.alert("操作提示","入库失败");
			}else{
				$.messager.alert("操作提示","入库成功");
				setProductEnterFormCode();
				loadOverProduceFrom();
				clearEnterForm();
			}
		}
		function clearEnterForm(){
			$("#pFormCode").combobox('unselect', $("#pFormCode").combobox("getValue"));
			$("#enterPerson").combobox('unselect', $("#enterPerson").combobox("getValue"));
			$("#productName").html("");
			$("#productCount").html("");
			$("#cusName").html("");
			$("#doCount").html("");
			$("#oneProductPage").html("");
			$("#totalProductCount").html("");
			$("#printPerson").html("");
			$("#bindPerson").html("");
			$("#planCount").html("");
			$("#paperName").html("");
			$("#mid").val("");
			$("#ofId").val("");
		}
		/*******************************************************产品入库结束******************************************************/
		
		function setProductOutFormCode(){
			$.post(opertionUrl+"productOut/findNextPoutFormCode",loadProductOutFormCodeSuccess,"text");
		}
		function loadProductOutFormCodeSuccess(data){
			$("#productOutFormCode").html(data);
		}
		function loadOverOrderFrom(){
			$.post(opertionUrl+"orderform/findOrderByState",{state:4},loadOverOrderFromSuccess,"json");
		}
		function loadOverOrderFromSuccess(data){
			$("#orderFormCode").combobox('loadData', data);
		}
		//查询订单详情
		function loadDetailOrderForm(){
			var ofid = $("#orderFormCode").combobox('getValue');
			$.post(opertionUrl+"orderform/findOrderById",{id:ofid},loadDetailOrderFromSuccess,"json");
		}
		function loadDetailOrderFromSuccess(data){
			if(data&&data.length>0){
				var obj = data[0];
				$("#outProductName").html(obj.productName);
				$("#outProductCount").html(obj.productCount);
				$("#pageCount").html(obj.pagination);
				$("#outPaperName").html(obj.paperDetail);
				$("#productSize").html(obj.productSize+"K");
				$("#printType").html(obj.printTypeName);
				$("#bindType").html(obj.bindTypeName);
				$("#giveDate").html(obj.expectDate);
				$("#outCusName").html(obj.cusName);
				$("#phoneNum").html(obj.cusPhone);	
				$("#oofid").val(obj.id);
				$("#ocusName").val(obj.id);
			}
			
		}
		
		function submitProductOutForm(){

			var para = '{"outCode":"'+$("#productOutFormCode").text()+'","fid":'+$("#oofid").val()+',"outCount":'+$("#outProductCount").text()+
				',"outPersonId":'+$("#outPerson").combobox("getValue")+',"acceptMan":"'+$("#getPerson").textbox("getValue")+'","acceptPhone":"'+$("#getPhoneNum").textbox("getValue")+'"}';
			$.post(opertionUrl+"productOut/saveProductOutForm",{para:para},saveProductFormSuccess,"text");
		}
		function saveProductFormSuccess(data){
			if(data=='-2'){
				$.messager.alert("操作提示","出库失败");
			}else{
				$.messager.alert("操作提示","出库成功");
				setProductOutFormCode();
				loadOverOrderFrom();
				clearOutForm();
			}
		}
		function clearOutForm(){
			$("#orderFormCode").combobox('unselect', $("#orderFormCode").combobox("getValue"));
			$("#outPerson").combobox('unselect', $("#outPerson").combobox("getValue"));
			$("#outProductName").html("");
			$("#outProductCount").html("");
			$("#pageCount").html("");
			$("#outPaperName").html("");
			$("#productSize").html("");
			$("#printType").html("");
			$("#bindType").html("");
			$("#giveDate").html("");
			$("#outCusName").html("");
			$("#phoneNum").html("");	
			$("#oofid").val("");
			$("#ocusName").val("");
			$("#getPerson").textbox("setValue","");
			$("#getPhoneNum").textbox("setValue","");
			
		}
	</script>
</head>
<body>
	<div class="easyui-tabs" style="width:auto;height:auto;">
		<div title="产品入库" style="padding:10px">
			<div style="padding:10px 60px 20px 60px">
				<form id="miff" method="post">
					<table class="tablecss" style="width:800px;">
						<tr>
							<th colspan="6" align="center">
								永兴印刷产品入库单
								<input id="mid" type="hidden" />
								<input id="ofId" type="hidden" />
							</th>
						</tr>
						<tr>
							<td>入库单编号:</td>
							<td id="piFormCode"></td>
							<td>生产单编号:</td>
							<td><input id="pFormCode" class="easyui-combobox" style="width: 200px;" data-options="valueField:'id',textField:'makeCode',onSelect:loadDetailProduceForm" /></td>							
						</tr>
						<tr>
							<td>产品名称:</td>
							<td id="productName"></td>
							<td>产品数量:</td>
							<td id="productCount"></td>
							
						</tr>
						<tr>
							<td>单品页码:</td>
							<td id="oneProductPage"></td>
							<td>产品页码总数:</td>
							<td id="totalProductCount"></td>
						</tr>
						<tr>
							<td>客户名称:</td>
							<td id="cusName"></td>	
							<td>已完成数量:</td>
							<td id="doCount"></td>
							
						</tr>
						<tr>
							<td>印刷工:</td>
							<td id="printPerson"></td>	
							<td>装订工:</td>
							<td id="bindPerson"></td>
						</tr>
						<tr>
							<td>安排生产数量:</td>
							<td id="planCount"></td>	
							<td>所选纸张:</td>
							<td id="paperName"></td>
						</tr>
						<tr>
							<td>入库数量:</td>
							<td><input id="enterCount" class="easyui-numberbox" type="text"  /></td>
							<td>剩余纸张数量:</td>
							<td><input id="remainPaperCount" class="easyui-numberbox" type="text"  /></td>	
						</tr>
						<tr>
							<td>入库人:</td>
							<td colspan="3"><input id="enterPerson" class="easyui-combobox" style="width: 200px;" data-options="valueField:'id',textField:'wname'" /></td>
						</tr>
						<tr>
							<td colspan="4" align="center">
								<a href="javascript:void(0)" class="easyui-linkbutton" onclick="submitProductEnterForm()">入库</a>
							</td>
						</tr>
						
					</table>
				</form>
				
			</div>
		</div>
		<div title="外协入库" style="padding:10px;">
			需确定入库形式
		</div>
		<div title="产品出库" style="padding:10px;">
			<div style="padding:10px 60px 20px 60px">
				<form id="miff" method="post">
					<table class="tablecss" style="width:800px;">
						<tr>
							<th colspan="6" align="center">
								永兴印刷产品出库单
								<input id="oofid" type="hidden" />
								<input id="ocusName" type="hidden" />
							</th>
						</tr>
						<tr>
							<td>出库单编号:</td>
							<td id="productOutFormCode"></td>
							<td>订单编号:</td>
							<td><input id="orderFormCode" class="easyui-combobox" style="width: 200px;" data-options="valueField:'id',textField:'formCode',onSelect:loadDetailOrderForm" /></td>							
						</tr>
						<tr>
							<td>产品名称:</td>
							<td id="outProductName"></td>
							<td>产品数量:</td>
							<td id="outProductCount"></td>
						</tr>
						<tr>
							<td>页码数量:</td>
							<td id="pageCount"></td>
							<td>纸张型号:</td>
							<td id="outPaperName"></td>
						</tr>
						<tr>
							<td>成品尺寸:</td>
							<td id="productSize"></td>
							<td>印刷工艺:</td>
							<td id="printType"></td>
						</tr>
						<tr>
							<td>装订方式:</td>
							<td id="bindType"></td>
							<td>交货时间:</td>
							<td id="giveDate"></td>
						</tr>
						<tr>
							<td>客户名称:</td>
							<td id="outCusName"></td>
							<td>联系电话:</td>
							<td id="phoneNum"></td>	
							
						</tr>
						<tr>
							<td>接货人员:</td>
							<td><input id="getPerson" class="easyui-textbox" type="text" /></td>
							
							<td>联系方式:</td>
							<td><input id="getPhoneNum" class="easyui-textbox" type="text" /></td>
							
						</tr>
						<tr>
							<td>出库人:</td>
							<td colspan="3"><input id="outPerson" class="easyui-combobox" style="width: 200px;" data-options="valueField:'id',textField:'wname'" /></td>
						</tr>
						<tr>
							<td colspan="4" align="center">
								<a href="javascript:void(0)" class="easyui-linkbutton" onclick="submitProductOutForm()">出库</a>
							</td>
						</tr>
						
					</table>
				</form>
			</div>
		</div>
	</div>
</body>
</html>