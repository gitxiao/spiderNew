<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>永兴印刷订单生产管理系统-首页</title>
	<link rel="stylesheet" type="text/css" href="css/easyui/easyui.css" />
	<link rel="stylesheet" type="text/css" href="css/easyui/icon.css" />
	<link rel="stylesheet" type="text/css" href="css/easyui/demo.css"/>
	<link rel="stylesheet" type="text/css" href="css/cf/table.css"/>
	<script type="text/javascript" src="js/easyui/jquery.min.js"></script>
	<script type="text/javascript" src="js/easyui/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="js/easyui/easyui-lang-zh_CN.js"></script>
	<script type="text/javascript" src="js/json2.js"></script>
	
	<script type="text/javascript" src="js/myConstants.js"></script>
	<script type="text/javascript" src="js/myUtils.js"></script>
	<script type="text/javascript" src="js/myNames.js"></script>
	
	<script>
		
		$(function(){
				setFormCode(getUserId());
				loadCustomerDate();
				loadPaperType();
				loadPartner();
				getDdData();
			});
			
		function fillDdData(data){
			$("#dg").datagrid({loadFilter:pagerFilter,loadMsg:'数据正在加载,请耐心的等待...',striped:true}).datagrid('loadData', data)
		}
		function getDdData(){
			$.post(opertionUrl+"orderform/getOrderFormByUserId",{userId:getUserId()},fillDdData,"json");
		}

		function setFormCode(userid){
			$.post(opertionUrl+"orderform/findNextFormCode",{userId:userid},loadNextCodeSuccess,"text");
			
		}
		function loadNextCodeSuccess(data){
			$("#formNum").textbox('setValue',data);
		}
		
		function loadPartner(){
			$.post(opertionUrl+"partner/findPaperType",loadPatnerSuccess,"json");
		}
		
		function loadPatnerSuccess(data){
			$("#partnerComb").combobox('loadData', data);
		}
			
		function loadPaperType(){
			$.post(opertionUrl+"material/findPaperType",loadPaperTypeSuccess,"json");
		}
		function loadPaperTypeSuccess(data){
			$("#paperType").combobox('loadData', data);
		}
		function loadPaperSize(){
			var dtype = $("#paperType").combobox('getValue');
			$.post(opertionUrl+"material/findPaperSize",{dtype:dtype},loadPaperSizeSuccess,"json");
		}
		function loadPaperSizeSuccess(data){
			$("#paperSize").combobox('loadData', data);
			$("#paperSize").combobox('unselect', $("#paperSize").combobox('getValue'));
		}
		function loadCustomerDate(){
			$.post(opertionUrl+"customer/findAll",loadDataSuccess,"text");
		}
		function loadDataSuccess(data){
			$("#customer").combobox('loadData', eval(data));
		}
		
		function getUserId(){
	
			var nurl = window.document.location.href;
			var codeIndex = nurl.indexOf("userid");
			if(codeIndex==-1) return "false";
			var keyValue = nurl.substring(codeIndex,nurl.length);
			if(keyValue.indexOf("=")==-1) return false;
			var values = keyValue.split("=");
			if(values!=null&&values.length!=0){
				return values[1];
			}else{
				return "false";
			}
		}
		
		function selectPtype(){
			var val = $("#maketype").combobox('getValue');
			if(val=="2"){
				$("#outhelp").css("display","");
			}else{
				$("#outhelp").css("display","none");
			}
			
		}
		
		function submitForm(){
			var obj = new Object();
			obj.formCode=$("#formNum").textbox('getValue');
			obj.customerId =$("#customer").combobox('getValue');
			obj.cusPhone = $("#phoneNum").textbox('getValue');
			obj.productName = $("#productName").textbox('getValue');
			obj.paperId =$("#paperSize").combobox('getValue');
			obj.productSize = $("#productSize").textbox('getValue');
			obj.pagination = $("#pagination").textbox('getValue');
			obj.printType = $("#printType").combobox('getValue');
			obj.bindtype = $("#bindtype").combobox('getValue');
			obj.printFrom=$("#printFrom").textbox('getValue');
			obj.bakCode = $("#bakCode").textbox("getValue");
			obj.demoCode = $("#demoCode").textbox("getValue");
			obj.formPrice = $("#formPrice").textbox("getValue");
			obj.makeType = $("#maketype").combobox('getValue');
			obj.partnerId = $("#partnerComb").combobox('getValue')? $("#partnerComb").combobox('getValue'):0;
			obj.remark = $("#remark").textbox("getValue");
			obj.printPrice = $("#printPrice").textbox("getValue")? $("#printPrice").textbox("getValue"):0;
			obj.productCount = $("#productCount").textbox("getValue");
			obj.designer = $("#designer").textbox("getValue");			
			obj.expectDate = $("#endDate").datebox("getValue");
			obj.templatePrice = $("#templatePrice").textbox("getValue");
			obj.templateNum = $("#templateNum").textbox("getValue");
			if(obj.makeType==2){
				obj.isPart = 1;
			}else {
				obj.isPart = 0;
			}
			obj.userId =  getUserId();
			obj.isGiveMoney = 0;
			obj.isGetMoney = 0;
			obj.isFinish = 1;
			obj.isGivePrice = 0;
			obj.state = 2;
			/*var giveMoneyDate;
			var finishDate;
			var submitDate;
			var getMoneyDate;*/
			$.post(opertionUrl+"orderform/saveForm",{para:JSON.stringify(obj)},addFormSuccuss,"text");
		}
		function addFormSuccuss(data){
			if(!data){
				$.messager.alert("操作提示","保存订单失败,请检查数据");
			}else if(data=="-2"){
				$.messager.alert("操作提示","保存订单失败,请检查数据");
			}else{
				$.messager.alert("操作提示","保存订单成功");
				$('#ff').form('clear');
				setFormCode(getUserId());
				getDdData();
			}
		}
		
		
	</script>
	<script>
		var toolbar = [{
			text:'查看详情',
			iconCls:'icon-search',
			handler:function(){scanForm();}
			},
			/*{text:'结算',
			iconCls:'icon-settle',
			handler:function(){settleAccount();}
			}*/
			];

		function scanForm(){
			//打开订单详情,读取选中的订单中的详细信息填充到dlg的表中
			var row = $("#dg").datagrid("getSelected");
			if(row){
			    fillContents("ddxq",row);
				$('#dlg').dialog('open');
			}else{
				$.messager.alert("操作提示","请选择要查看的订单");
			}
		}

		function settleAccount(){
			$.messager.confirm("操作提示", "您确定该订单需要结算吗？", function (data) {  
				if (data) {  
					alert("确定");  
				}  
				else {  
					alert("取消");  
				}  
			});   
		}
		
		
		$(function(){
			//$('#dg').datagrid({data:getData()}).datagrid('clientPaging');
		});
	</script>
	<script>
		function submitForm2(){
			$.messager.confirm("操作提示", "您确定该订单需要结算吗？", function (data) {  
				if (data) {  
					alert("确定");  
				}  
				else {  
					alert("取消");  
				}  
			});    
			//$('#ff2').form('submit');
		}
		
	</script>
	
</head>
<body>
	<div class="easyui-tabs" style="width:auto;height:auto;">
		<div title="在线下订单" style="padding:10px">
			<div style="padding:10px 60px 20px 60px">
				<form id="ff" method="post">
					<table cellpadding="5">
						<tr>
							<td>订单编号:</td>
							<td><input id="formNum" class="easyui-textbox" data-options="required:true" readonly="readonly" type="text" name="formNum" ></input></td>
							<td>客户名称:</td>
							<td><input id="customer" class="easyui-combobox" data-options="valueField:'id',textField:'cusName',editable:false,"></input></td>
							<td>联系电话:</td>
							<td><input id="phoneNum" missingMessage="请输入电话号码(格式:0318861000/13900006666)" class="easyui-numberbox" data-options="required:true" type="text" name="phoneNum" ></input></td>
						</tr>
						<tr>
							
							<td>印刷品名称:</td>
							<td><input id="productName" missingMessage="印刷品名称为必输项" class="easyui-textbox" data-options="required:true" type="text" name="productName" ></input></td>
							<td>纸张类型:</td>
							<td>
								<input id="paperType" class="easyui-combobox" data-options="valueField:'dtype',textField:'mname',onSelect:loadPaperSize,editable:false "></input>
							</td>
							<td>纸张规格:</td>
							<td>
								<input id="paperSize" class="easyui-combobox" data-options="valueField:'id',textField:'msize',editable:false "></input>
							</td>
						</tr>
						<tr>
							<td>成品尺寸:</td>
							<td>
								<input id="productSize" missingMessage="成品尺寸为数字必输项" class="easyui-numberbox" style="width:100px" data-options="required:true" type="text" name="productSize" /> &nbsp;&nbsp;K
							</td>
							<td>页码数量:</td>
							<td><input id="pagination"  missingMessage="数字必输项,单面印刷时页码数X2" class="easyui-numberbox" data-options="required:true" name="pagination" ></input></td>
							<td>印刷工艺:</td>
							<td>
								<select id="printType" class="easyui-combobox" data-options="editable:false" name="印刷工艺" style="width:140px;">
									<option value="1">覆膜</option>
									<option value="2">UV</option>
									<option value="3">压纹</option>
									<option value="4">起鼓</option>
									<option value="5">烫金</option>
									<option value="6">烫银</option>
									<option value="7">花线</option>
									<option value="8">磨切</option>
									<option value="9">压痕</option>
								</select>
							</td>
						</tr>
						<tr>
							<td>装订方式:</td>
							<td>
								<select id="bindtype" class="easyui-combobox" data-options="editable:false" name="装订方式" style="width:140px;">
									<option value="1">线订</option>
									<option value="2">胶订</option>
									<option value="3">骑马订</option>
									<option value="4">无缝装</option>
								</select>
							</td>
							<td>成品数量:</td>
							<td><input id="productCount" missingMessage="成品数量为数字必输项" class="easyui-numberbox" data-options="required:true" name="productCount" ></input></td>
							<td>交货时间:</td>
							<td><input id="endDate" class="easyui-datebox" ></input></td>
						</tr>
						<tr>
							<td>设计师:</td>
							<td>
								<input id="designer" class="easyui-textbox" data-options="required:true" type="text" name="designer" />
							</td>
							<td>出版地:</td>
							<td>
								<select id="printFrom" class="easyui-combobox" name="出版地" style="width:140px;">
									<option value="1">印刷学校</option>
									<option value="2">飞腾</option>
									<option value="3">衡武</option>
								</select>
							</td>
							<td>内资备案号:</td>
							<td>
								<input id="bakCode" class="easyui-textbox" data-options="required:true" type="text" name="bakCode" />
							</td>
						</tr>

						<tr>
							<td >版数:</td>
							<td ><input id="templateNum" class="easyui-numberbox" missingMessage="版数为数字必输项" data-options="required:true" style="width:140px;"></input></td>
							<td >版单价:</td>
							<td ><input id="templatePrice" class="easyui-numberbox" missingMessage="版单价为数字必输项" data-options="required:true" style="width:140px;"></input></td>
							<td>订单价格：</td>
							<td><input id="formPrice" class="easyui-numberbox"  missingMessage="订单价格为数字必输项"  data-options="required:true" name="formPrice" ></input></td>
						</tr>
						<tr>
							<td>小样备案号:</td>
							<td>
								<input id="demoCode" class="easyui-textbox" data-options="required:true" type="text" name="demoCode" />
							</td>
							<td>加工类型:</td>
							<td>
								<select id="maketype" class="easyui-combobox" name="加工类型" data-options="onSelect:selectPtype ,editable:false" style="width:140px;">
									<option value="1">自印</option>
									<option value="2">外协</option>
								</select>
							</td>
						</tr>
						<tr id="outhelp" style="display:none">
							<td>外协单位:</td>
							<td ><input id="partnerComb" style="width: 140px" class="easyui-combobox" data-options="valueField:'id',textField:'partnerName',editable:false"></input></td>
							<td>外协价格：</td>
							<td><input id="printPrice" class="easyui-numberbox" missingMessage="外协价格为数字必输项" data-options="required:true" name="printPrice" style="width:140px;"></input></td>
						</tr>
						<tr>
							<td>备注</td>
							<td colspan="5"> <input id="remark" style="width:600px;height: 100px;" class="easyui-textbox" type="text" name="remark" /> </td>
						</tr>
					</table>
				</form>
				<div style="text-align:center;padding:5px">
					<a href="javascript:void(0)" class="easyui-linkbutton" onclick="submitForm()">提交</a>
					<!--
					<a href="javascript:void(0)" class="easyui-linkbutton" onclick="clearForm()">重置</a>
					-->
				</div>
			</div>
		</div>
		<!-- ------------------------------------------------------------------在线下订单完成------------------------------------------------------------------------- -->
		<div title="订单查询" style="padding:10px;">
			<div class="easyui-panel" style="padding:5px;width:780px;">
				<span style="padding:3px 5px 3px 10px;">生产状态：</span>
				<a href="#" class="easyui-linkbutton" data-options="toggle:true,group:'g1',selected:true" style="margin:3px 5px 3px 10px;">全&nbsp&nbsp&nbsp&nbsp部</a>
				<a href="#" class="easyui-linkbutton" data-options="toggle:true,group:'g1'" style="margin:3px 5px 3px 10px;">加工中</a>
				<a href="#" class="easyui-linkbutton" data-options="toggle:true,group:'g1'" style="margin:3px 5px 3px 10px;">已完成</a>
				<span style="padding:3px 5px 3px 200px;">收款状态：</span>
				<a href="#" class="easyui-linkbutton" data-options="toggle:true,group:'g2',selected:true" style="margin:3px 5px 3px 10px;">全&nbsp&nbsp&nbsp&nbsp部</a>
				<a href="#" class="easyui-linkbutton" data-options="toggle:true,group:'g2'" style="margin:3px 5px 3px 10px;">未收款</a>
				<a href="#" class="easyui-linkbutton" data-options="toggle:true,group:'g2'" style="margin:3px 5px 3px 10px;">已收款</a>
			</div>
			<table id="dg" style="width:780px;height:350px" data-options="
						rownumbers:true,
						singleSelect:true,
						autoRowHeight:false,
						pagination:true,
						pageSize:10,
						toolbar:toolbar">
				<thead>
					<tr>
						<th field="formCode" width="120">订单编号</th>
						<th field="cusName" width="150">客户名称</th>
						<th field="cusPhone" width="100">联系电话</th>
						<th field="expectDate" width="80" align="right">交货日期</th>
						<th field="printTypeName" width="40" align="right">工艺</th>
						<th field="pagination" width="60" align="right">成品页数</th>
						<th field="productCount" width="60">成品数量</th>
						<th field="pstate" width="60">生产状态</th>
						<th field="dstate" width="60">收款状态</th>
						<th field="outstate" width="60">付款状态</th>
					</tr>
				</thead>
			</table>
			<div id="dlg" class="easyui-dialog" title="订单详情" data-options="iconCls:'icon-save',closed:true" style="width:800px;height:500px;padding:10px">
				<form id="ff2" method="post">
					<table class="tablecss" >
						<tr>
							<th colspan="6" align="center">永兴印刷订单详情</th>
						</tr>
						<tr>
							<td>订单编号:</td>
							<td id="ddxqformCode" name="ddxq">YXYS20160309001</td>
							<td>接单时间:</td>
							<td id="ddxqformDate" name="ddxq">03/10/2016</td>
							<td>交货时间:</td>
							<td id="ddxqexpectDate" name="ddxq">20160501</td>
						</tr>
						<tr>
							<td>客户名称:</td>
							<td id="ddxqcusName" name="ddxq">河北圣春冀暖有限责任公司</td>
							<td>联系电话:</td>
							<td id="ddxqcusPhone" name="ddxq">03188690678</td>
							<td>产品名称:</td>
							<td id="ddxqproductName" name="ddxq">产品介绍宣传页</td>
						</tr>
						<tr>
							<td>成品尺寸:</td>
							<td id="ddxqproductSize" name="ddxq">A4</td>
							<td>印刷工艺:</td>
							<td id="ddxqprintTypeName" name="ddxq">铜版</td>
							<td>装订方式:</td>
							<td id="ddxqbindTypeName" name="ddxq">线订</td>
						</tr>
						<tr>
							<td>纸张规格:</td>
							<td id="ddxqpaperDetail" name="ddxq">XX牌纸（厚度2mm）</td>
							<td>设计师:</td>
							<td id="ddxqdesigner" name="ddxq">XXXX</td>
							<td>出版地:</td>
							<td id="ddxqprintFrom" name="ddxq">河北冀州</td>
						</tr>
						<tr>
							<td>内资备案号:</td>
							<td id="ddxqbakCode" name="ddxq">YXNZ201603100001</td>
							<td>小样备案号:</td>
							<td id="ddxqdemoCode" name="ddxq">YXXY201603100001</td>
							<td>加工类型:</td>
							<td id="ddxqmakeTypeName" name="ddxq">自印</td>
						</tr>
						<tr>
							<td>成品数:</td>
							<td id="ddxqproductCount" name="ddxq">100</td>
							<td>单品页码数:</td>
							<td id="ddxqpagination" name="ddxq">10</td>
							<td>备注:</td>
							<td id="ddxqremark" name="ddxq"></td>
						</tr>
						<tr>
							<td>版数:</td>
							<td id="ddxqtemplateNum" name="ddxq">100</td>
							<td>版单价:</td>
							<td id="ddxqtemplatePrice" name="ddxq">10</td>
							<td>报价备注:</td>
							<td id="ddxqpriceRemark" name="ddxq"></td>
						</tr>
						<tr>
							<td>已生产页码数:</td>
							<td id="ddxqproducedNum" name="ddxq">YXNZ201603100001</td>
							<td>总页码数：</td>
							<td id="ddxqallPageNum" name="ddxq">50</td>
							<td>未分配页码数：</td>
							<td id="ddxqunAssignedNum" name="ddxq">50</td>
						</tr>
					</table>
				</form>
			</div>
		</div>
	</div>
</body>
</html>