<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>爬虫管理</title>
	<link rel="stylesheet" type="text/css" href="css/easyui/easyui.css" />
	<link rel="stylesheet" type="text/css" href="css/easyui/icon.css"/>
	<link rel="stylesheet" type="text/css" href="css/easyui/demo.css"/>
	<link rel="stylesheet" type="text/css" href="css/cf/table.css"/>
	<script type="text/javascript" src="js/easyui/jquery.min.js"></script>
	<script type="text/javascript" src="js/easyui/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="js/easyui/easyui-lang-zh_CN.js"></script>

	<script type="text/javascript" src="js/json2.js"></script>
	<script type="text/javascript" src="js/myNames.js"></script>
	<script type="text/javascript" src="js/myUtils.js"></script>
	<script type="text/javascript" src="js/myConstants.js"></script>
	
	<style>
		.loginForm p { margin:10px 0;}
	</style>
</head>
<body>
	<div class="easyui-tabs" style="width:auto;height:auto;">
		
		<!--<div title="结果展示" style="padding:10px;">
			<table id="kcdg" style="width:780px;height:350px" data-options="
						rownumbers:true,
						singleSelect:true,
						autoRowHeight:false,
						pagination:true,
						pageSize:10 ">
				<thead>
					<tr>
						<th field="title" width="120" >标题</th>
						<th field="url" width="120">网址</th>
						<th field="keyword" width="100">关键字</th>
						<th field="pubDate" width="80" align="right">发布日期</th>
						<th field="depth" width="80" align="right">深度</th>
					</tr>
				</thead>
			</table>
		</div>
		
		--><div title="关键字管理" style="padding:10px;">
			<div class="easyui-panel" style="padding:5px;width:780px;">
				<span style="padding:3px 5px 3px 10px;">关键字状态：</span>
				<a href="#" class="easyui-linkbutton" data-options="toggle:true,group:'g1',selected:true" style="margin:3px 5px 3px 10px;" onclick="getYGData()">全部</a>
				<a href="#" class="easyui-linkbutton" data-options="toggle:true,group:'g1'" style="margin:3px 5px 3px 10px;" onclick="getKeywordByState('1')">在用</a>
				<a href="#" class="easyui-linkbutton" data-options="toggle:true,group:'g1'" style="margin:3px 5px 3px 10px;" onclick="getKeywordByState('0')">停用</a>
			</div>
			<table id="kwdg" style="width:780px;height:350px" data-options="
						rownumbers:true,
						singleSelect:true,
						autoRowHeight:false,
						pagination:true,
						pageSize:10,
						toolbar:toolbar">
				<thead>
					<tr>
						<th field="keyword" width="60">关键字</th>
						<th field="stateName" width="80" >状态</th>
					</tr>
				</thead>
			</table>
			<div id=addkwdlg class="easyui-dialog" title="添加关键字" data-options="iconCls:'icon-save',closed:true,modal:true" style="width:400px;height:260px;padding:10px;top:100px;">
				<form id="ygdlgForm" method="post">
					<table class="tablecss" align="center">
						<tr>
							<th colspan="12" align="center">新关键字</th>
						</tr>
						<tr>
							<td colspan="3">关键字:</td>
							<td colspan="9"><input id="name" class="easyui-textbox" type="text" name="name" data-options="required:true"></input></td>
							
						</tr>
						<tr>
							<td colspan="12" align="center"> 
								<a href="javascript:void(0)" class="easyui-linkbutton" onclick="addKeywordCommit()">提交</a>
							</td>
						</tr>
						
					</table>
				</form>
			</div>
			
		</div>
		<script>
				//---------------------------------关键字管理------------------------------------->>>
				var toolbar = [{
					text:'增加',
					iconCls:'icon-add',
					handler:function(){addKeyword();}
				},
				{	text:'启/停用',
					iconCls:'icon-edit',
					handler:function(){modifyKeyword();}
				}];
				
				//打开添加材料对话框
				function addKeyword(){
					$("#addkwdlg").dialog("open");
				}
				function addKeywordCommit(){
					var name = $('#name').textbox('getValue');
					//var remark = $('#remark').textbox('getValue');
					//alert(name + ", " + remark);
					if(!name){
						$.messager.alert("提示","请输入关键字");
					}else{
						var data = "{\"keyword\":\"" + name+ 
								   //"\",\"remark\":\"" + remark + 
								   "\",\"state\":" + 1 + 
								   "}";
						$.post(opertionUrl + "keyword/save",{para:data},addResult,"text");
					}
				}
				function addResult(sresult){
					//alert("sresult,sresult == \"undefined\" = " + sresult + "," + (sresult == "undefined"));
					if(sresult == "-1" || sresult == "undefined"){
						$.messager.alert("提示","添加关键字失败 错误信息: " + sresult);
					}else{
						$.messager.alert("提示","添加关键字成功");
						getKwData();
						$("#addkwdlg").dialog("close");
					}
				}
				function modifyKeyword(){
					//打开修改对话框
					
					var mrow = $("#kwdg").datagrid("getSelected");
					if(mrow){
						$.messager.confirm("操作提示", "您确定修改关键字状态吗？", function (data) {  
							if (data) { 
								mrow.state = mrow.state ^ 1;
								$.post(opertionUrl+"keyword/changeState",{para:JSON.stringify(mrow)},changeResult,"text");
							}  
						});
					}else{
						$.messager.alert("操作提示","请选择要修改的关键字");
					}
				}
				function changeResult(sresult){
					if(sresult == "-1"){
						$.messager.alert("提示","修改失败");
					}else{
						//getCLData();		//刷新材料数据
						$.messager.alert("提示","修改成功");
						
						var row = $("#kwdg").datagrid("getSelected");
			            var index = $('#kwdg').datagrid('getRowIndex', row);
			            row.stateName = row.state == 1 ? '在用' : '停用'
			            $('#kwdg').datagrid('refreshRow', index);
					}
				}
				//---------------------------------关键字管理-------------------------------------<<<
				
		
				function fillKeywordData(jsdata){
					//printObject(jsdata,'jsdata',2);
					//alert("jsdata = " + jsdata);
					//var kwData = eval(jsdata); 
					$("#kwdg").datagrid({loadFilter:pagerFilter,loadMsg:'数据正在加载,请耐心的等待...',striped:true})
					
					var clrows = [];
					for(var m = 0; m < jsdata.length; m++){						
						console.log('jsdata[m].state == 1' + (jsdata[m].state == 1) + ',' + jsdata[m].state);
						clrows.push({
							id:jsdata[m].id,
							state:jsdata[m].state,
							keyword:jsdata[m].keyword,
							stateName:jsdata[m].state == 1 ? '在用' : '停用'
						});
					}
					$("#kwdg").datagrid('loadData', clrows)
				}
				
				function getKeywordAll(){
					$.post(opertionUrl+"keyword/findAll",fillKeywordData,"json");
				}
				function getKeywordByState(state){
					$.post(opertionUrl+"keyword/findByState",{para:state},fillKeywordData,"json");
				}
				
				//装载爬取数据
				function fillData(data){
					$("#kcdg").datagrid({loadFilter:pagerFilter,loadMsg:'数据正在加载,请耐心的等待...',striped:true}).datagrid('loadData', data)
				}
				function getData(){
					//从服务器获取材数据
					$.post(opertionUrl + "NewsService/findNews",{para:"我是参数"},fillData,"json");
				}
				
				
				$(function(){
					//getData();
					getKeywordAll();			//获取关键字
				});

			</script>
	</div>
</body>
</html>