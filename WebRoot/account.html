<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>永兴印刷订单生产管理系统-首页</title>
	<link rel="stylesheet" type="text/css" href="css/easyui/easyui.css"/>
	<link rel="stylesheet" type="text/css" href="css/easyui/icon.css"/>
	<link rel="stylesheet" type="text/css" href="css/easyui/demo.css"/>
	<link rel="stylesheet" type="text/css" href="css/cf/table.css"/>
	<script type="text/javascript" src="js/easyui/jquery.min.js"></script>
	<script type="text/javascript" src="js/easyui/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="js/easyui/easyui-lang-zh_CN.js"></script>
	<!--<script type="text/javascript" src="js/jQuery.print.js"></script>
	--><script type="text/javascript" src="js/jquery.jqprint-0.3.js"></script>
	
	<script type="text/javascript" src="js/myConstants.js"></script>
	<script type="text/javascript" src="js/myNames.js"></script>
	<script type="text/javascript" src="js/myUtils.js"></script>
	
	<script>
		$(function(){$("#formNum").textbox('setValue','YXYSJ201602220001');});
	</script>
</head>
<body>
	<div class="easyui-tabs" style="width:auto;height:auto;">
		<div id="my_print1" title="费用支出" style="padding:10px">
			<div style="padding:10px 60px 20px 60px">
				<form id="ff" method="post">
					<table cellpadding="5">
						<tr>
							<td>单据编号:</td>
							<td><input id="formNum" class="easyui-textbox" readonly="true" type="text" name="name" data-options="editable:false,required:true"></input></td>
							<td>时间:</td>
							<td><input id="formTime" class="easyui-datebox" value="10/11/2012" style="width:200px" data-options="editable:false,required:true,"></input></td>
						</tr>
						<tr>
							<td>负责人:</td>
							<td>
								<select class="easyui-combobox" id="workerBox" name="负责人" style="width:140px;" data-options="
											required:true,
											editable:false,
											valueField:'id',
											textField:'wname' ">
								</select>
							</td>
							<td>支出金额:</td>
							<td ><input id="formMoneyOut" class="easyui-numberbox" data-options="required:true" name="name" data-options="required:true"></input></td>
						</tr>
						<tr>
							<td>支出类型:</td>
							<td colspan="3">
								<select class="easyui-combobox" id="formType" name="支出类型" style="width:180px;" data-options="editable:false">
									<option value=0>计入成本核算</option>
									<option value=1>不计入成本核算</option>
								</select>
							</td>
						</tr>
						<tr>
							<td>备注:</td>
							<td colspan="3">
								<input class="easyui-textbox" id="formRemark" data-options="multiline:true" type="text" name="name" style="width:355px;height:100px;" >
							</td>
						</tr>
						<tr>
							<td colspan="4" align="center">
								<a href="javascript:void(0)" class="easyui-linkbutton" onclick="submitForm()">提交</a>
								<a href="javascript:void(0)" class="easyui-linkbutton" onclick="clearForm()">重置</a>
							</td>
							
						</tr>
					</table>
				</form>
				<script>
					function submitForm(){
						var moneyCode = $('#formNum').val();
                       	var outDate = $("#formTime").val();
                        var outPersonId = $("#workerBox").combobox('getValue');
                        var outCount = $('#formMoneyOut').val();
                        var outType = $('#formType').val();
                        var remak = $('#formRemark').val();
                        if(!outDate){
                            alert("请选择日期");
                        }else if(!outPersonId){
                            alert("请选择负责人");
                        }else if(!outCount){
                            alert("请输入支出金额");
                        }else if(!outType){
                            alert("请选择支出类型");
                        }else{
                            var data = "{\"moneyCode\":\"" + moneyCode + 
                                           "\",\"outDate\":\"" + outDate + 
                                           "\",\"outPersonId\":\"" + outPersonId + 
                                           "\",\"outCount\":\"" + outCount +
                                           "\",\"outType\":\"" + outType +
                                           "\",\"remak\":\"" + remak +
                                            "\"}";
                            alert(data);
                            $.post(opertionUrl+"moneyout/saveMoneyOutInfo",{para:data},addMoneyOutResult,"text");
                        }
                        //$('#ff4').form('submit');
					}
					function addMoneyOutResult(sresult){
						alert(sresult);
                        if(sresult == "-1"){
                            alert("提交失败");
                        }else if(sresult == "undefined"){
                            alert("提交失败");
                        }else{
                            alert("提交成功");
                        }
                    }
					function clearForm(){
						$('#ff').form('clear');
						
						/*$("#my_print1").jqprint({
							debug: false, 			//如果是true则可以显示iframe查看效果（iframe默认高和宽都很小，可以再源码中调大），默认是false
						    importCSS: true, 		//true表示引进原来的页面的css，默认是true。（如果是true，先会找$("link[media=print]")，若没有会去找$("link")中的css文件）
						    printContainer: true, 	//表示如果原来选择的对象必须被纳入打印（注意：设置为false可能会打破你的CSS规则）。
						    operaSupport: false		//表示如果插件也必须支持歌opera浏览器，在这种情况下，它提供了建立一个临时的打印选项卡。默认是true
						});*/
						/*$("#my_print1").print({
							globalStyles: true,
						    mediaPrint: false,
						    stylesheet: null,
						    noPrintSelector: ".no-print",
						    iframe: true,
						    append: null,
						    prepend: null,
						    manuallyCopyFormValues: true,
						    deferred: $.Deferred()
						});*/
					}
				</script>
			</div>
		</div>
		<div id="my_print2" title="工资提成" style="padding:10px;">
			<div class="easyui-panel" style="padding:5px;width:840px;">
				<span style="padding:3px 0px 3px 5px;">生产状态：</span>
				<a href="#" class="easyui-linkbutton" data-options="toggle:true,group:'g1',selected:true" style="margin:3px 5px 3px 0px;">全&nbsp&nbsp&nbsp&nbsp部</a>
				<a href="#" class="easyui-linkbutton" data-options="toggle:true,group:'g1'" style="margin:3px 5px 3px 5px;">加工中</a>
				<a href="#" class="easyui-linkbutton" data-options="toggle:true,group:'g1'" style="margin:3px 5px 3px 5px;">已完成</a>
				<span style="padding:3px 0px 3px 10px;">提成状态：</span>
				<a href="#" class="easyui-linkbutton" data-options="toggle:true,group:'g3',selected:true" style="margin:3px 5px 3px 0px;">全&nbsp&nbsp&nbsp&nbsp部</a>
				<a href="#" class="easyui-linkbutton" data-options="toggle:true,group:'g3'" style="margin:3px 5px 3px 5px;">未提成</a>
				<a href="#" class="easyui-linkbutton" data-options="toggle:true,group:'g3'" style="margin:3px 5px 3px 5px;">已提成</a>
			</div>
			<table id="scddg" style="width:840px;height:350px" data-options="
						rownumbers:true,
						singleSelect:true,
						autoRowHeight:false,
						pagination:true,
						pageSize:10,
						toolbar:toolbar">
				<thead>
					<tr>
						<th field="scformnum" width="150">生产单编号</th>
						<th field="formnum" width="150">订单编号</th>
						<th field="author" width="60">车间主任</th>
						<th field="printman" width="60" >印刷工</th>
						<th field="bindman" width="60" >装订工</th>
						<th field="saveman" width="60" >库管</th>
						<th field="plannum" width="60">安排数量</th>
						<th field="donum" width="60">生产数量</th>
						<th field="dostate" width="60">生产状态</th>
						<th field="gmstate" width="60">提成状态</th>
					</tr>
				</thead>
			</table>
			<div id="scddlg" class="easyui-dialog" title="生产单详情" data-options="iconCls:'icon-save',closed:true" style="width:800px;height:500px;padding:10px">
				<form id="ff2" method="post">
					<table class="tablecss" >
						<tr>
							<th colspan="6" align="center">永兴印刷生产单详情</th>
						</tr>
						<tr>
							<td>生产单编号:</td>
							<td>YXSC20160309001</td>
							<td>订单编号:</td>
							<td>YXYS20160309001</td>
							<td>安排时间:</td>
							<td>03/10/2016</td>
							
						</tr>
						<tr>
							<td>印刷品名称:</td>
							<td>产品介绍宣传页</td>
							<td>客户名称:</td>
							<td>河北春风实业集团</td>
							<td>联系电话:</td>
							<td>03188690678</td>
							
						</tr>
						<tr>
							<td>车间主任:</td>
							<td>王大有</td>
							<td>印刷工:</td>
							<td>刘福贵</td>
							<td>装订工:</td>
							<td>韩艳丽</td>
						</tr>
						<tr>
							<td>库管:</td>
							<td>赵保国</td>
							<td>安排数量:</td>
							<td>100</td>
							<td>生产数量:</td>
							<td>100</td>
						</tr>

						

						<tr>
							<td>完成时间:</td>
							<td>03/10/2016</td>
							<td>完成状态:</td>
							<td>已完成</td>
							<td>提成状态:</td>
							<td>未提成</td>
						</tr>

						<tr>
							<td>印刷工提成:</td>
							<td colspan="2"><input id="ysgtc1" class="easyui-numberbox" data-options="required:true" name="name" ></input></td>
							<td>装订工提成：</td>
							<td colspan="2"><input id="zdgtc1" class="easyui-numberbox" data-options="required:true" name="name" ></input></td>
						</tr>
						<tr>
							<td colspan="6" align="center">
								<a href="javascript:void(0)" class="easyui-linkbutton" onclick="submitManMoney()">提成</a>
							</td>
						</tr>
					</table>
				</form>
				
			</div>
			<div id="tcdlg" class="easyui-dialog" title="订单报价" data-options="iconCls:'icon-save',closed:true" style="width:300px;height:250px;padding:10px">
				<form id="ff4" method="post">
					<table cellpadding="5">
						<tr>
							<td>生产单编号:</td>
							<td>YXYS20160309001</td>
						</tr>
						<tr>
							<td>生产数量</td>
							<td>100</td>
						</tr>
						<tr>
							<td>印刷工提成:</td>
							<td><input id="ysgtc2" class="easyui-textbox" type="text" name="name" ></input></td>
						</tr>
						<tr>
							<td>装订工提成:</td>
							<td><input id="zdgtc2" class="easyui-textbox" type="text" name="name" ></input></td>
						</tr>
						<tr>
							<td colspan="2" align="center"><a href="javascript:void(0)" class="easyui-linkbutton" onclick="submitManMoney()">提成</a></td>
						</tr>
					</table>
				</form>
			</div>
			<script>
				var toolbar = [{
					text:'查看详情',
					iconCls:'icon-search',
					handler:function(){scanSCForm();}
					},{text:'提成',
					iconCls:'icon-outsettle',
					handler:function(){setManMoney();}
					}];
				
				function scanSCForm(){
					$("#scddlg").dialog('open');
				}

				function setManMoney(){
					$("#tcdlg").dialog('open');
				}

				function submitManMoney(){
					$.messager.alert("操作提示","提成完成");
					$('#tcdlg').dialog('close');
					
					/*$("#my_print2").print({
						globalStyles: true,
					    mediaPrint: false,
					    stylesheet: null,
					    noPrintSelector: ".no-print",
					    iframe: true,
					    append: null,
					    prepend: null,
					    manuallyCopyFormValues: true,
					    deferred: $.Deferred()
					});*/
				}


				function getData(){
					var rows = [];
					for(var i=1; i<=800; i++){
						var amount = Math.floor(Math.random()*1000);
						var price = Math.floor(Math.random()*1000);
						var scstr,numstr,pstr,dstr;
						if(i<10){
							 numstr = 'YXYS2016030900'+i;
							 scstr = 'YXSC2016030900'+i;
							 if(i%2==0){
								pstr = '已完成';
								dstr = '已提成';
							 }else{
								pstr = '加工中';
								dstr = '未提成';
								
							 }
						}else if(i<100){
							numstr = 'YXYS201603090'+i;
							scstr = 'YXSC201603090'+i;
							if(i%2==0){
								pstr = '已完成';
								dstr = '已提成';
							
							 }else{
								pstr = '已完成';
								dstr = '未提成';
							
							 }
						}else{
							numstr = 'YXYS20160309'+i;
							scstr = 'YXSC20160309'+i;
							pstr = '已完成';
							dstr = '已提成';
					
						}

						rows.push({
							scformnum:scstr,
							formnum:numstr,
							author: '王大有',
							printman:'刘福贵',
							bindman:'韩艳丽',
							saveman: '赵保国',
							plannum: '100',
							donum: '100',
							dostate: pstr,
							gmstate: dstr
						});
					}
					return rows;
				}
				
				
				function getAllWorkerData(){
					$.post(opertionUrl+"workerinfo/findAllWorkerInfo",fillWorkerData,"text");
				}
				function fillWorkerData(jsdata){
					$("#workerBox").combobox('loadData', eval(jsdata));
				}
				
				/*$(function(){
					getAllWorkerData();
					$("#scddg").datagrid({loadFilter:pagerFilter,loadMsg:'数据正在加载,请耐心的等待...',striped:true}).datagrid('loadData', getData())
				});*/
				
				function loadData(){
					getAllWorkerData();
					$("#scddg").datagrid({loadFilter:pagerFilter,loadMsg:'数据正在加载,请耐心的等待...',striped:true}).datagrid('loadData', getData())
				}
				$(document).ready(loadData);
			</script>
		</div>
	</div>
</body>
</html>